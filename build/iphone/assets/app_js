function retrieveData(e){versionJSONFiles=1;var i=Titanium.Network.createHTTPClient({onload:function(){var i=JSON.parse(this.responseText);e(i)},onerror:function(){if("iphone"===osname)var e=require("ui/common/IndexIOS");if("ipad"===osname)var e=require("ui/common/IndexIpad");(new e).open()},timeout:1e3});Ti.API.info("Buscando fecha de version de los trucks en general  a actualizar:");var a=Titanium.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),"version.json");a.setRemoteBackup=!1;var o="";a.exists()?(fileTmp=JSON.parse(a.read().text),o=fileTmp.version,Ti.API.info("Ultima fecha de actualización:"+o)):(Ti.API.info("Se busca por primera vez"),o="2014-10-01 13:00:0"),Ti.API.info("Se envía http://s544443713.onlinehome.mx/AppTrucks/app/getUpdates.php?d="+o),i.open("GET","http://s544443713.onlinehome.mx/AppTrucks/app/getUpdates.php?d="+o),i.send()}var separadorImg="",osname=Ti.Platform.osname;separadorImg="iphone"===osname||"ipad"===osname?"":"mobileweb"===osname?"":"/";var currentLat=0,currentLon=0;("iphone"===osname||"ipad"===osname)&&(Ti.Geolocation.purpose="Recieve User Location",Titanium.Geolocation.getCurrentPosition(function(e){return e.success?(currentLon=e.coords.longitude,void(currentLat=e.coords.latitude)):void alert("Could not retrieve location")}));var win=Ti.UI.createWindow({backgroundImage:separadorImg+"ui/img/android/logo.png",fullscreen:!0});retrieveData(function(e){var i=e.version,a=e.numTrucks,o=e.trucks,t=Titanium.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),"version.json");if(t.setRemoteBackup=!1,t.exists()?(dataVersion=JSON.parse(t.read().text),Ti.API.info("Fecha de Versión Actual desde APD"+dataVersion.version)):(t=Titanium.Filesystem.getFile(Titanium.Filesystem.getResourcesDirectory(),"version.json"),t.setRemoteBackup=!1,dataVersion=JSON.parse(t.read().text),Ti.API.info("Fecha de Versión Actual desde RD"+dataVersion.version)),Ti.API.info(a+"?<"+i),a>0){Ti.API.info("!Hay nuevos datos disponibles!"),Ti.API.info("Trucks nuevos:"+o);var n=Titanium.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),"trucks.json");for(n.setRemoteBackup=!1,n.deleteFile(),n.write('{"trucks":'+JSON.stringify(o)+"}"),Ti.API.info("!Creando archivos individuales de los trucks!"+a),k=0;a>k;k++){var r=o[k],t=Titanium.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),o[k].idTruck+".json");t.setRemoteBackup=!1,t.exists()&&t.deleteFile(),t.write('{"datos":'+JSON.stringify(r)+"}"),Ti.API.info("Actualizo archivo:"+o[k].idTruck+".json")}var s=Titanium.Network.createHTTPClient({onload:function(){var i=Ti.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory()+"../Library/Caches/","imagenesTrucks.zip");if(i.setRemoteBackup=!1,i.write(this.responseData),"iphone"===osname||"ipad"===osname){var i=Ti.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory()+"../Library/Caches/","imagenesTrucks.zip");i.setRemoteBackup=!1;var a=require("de.marcelpociot.zip");a.unzip({file:i,target:Ti.Filesystem.applicationDataDirectory+"../Library/Caches/",overwrite:!0,success:function(e){Ti.API.info("OK UNZIP"+e+i.nativePath),i.setRemoteBackup=!1,i.deleteFile(),i.exists()&&Ti.API.info("No se borrò el archivo")},error:function(e){Ti.API.info("ERROR ZIP"+e)},progress:function(e){Ti.API.info("OK ZIP"+e)}})}else alert("Imposible reconocer el dispositivo"),Ti.API.info("Unzip imgs:"+result);var o=Titanium.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),"version.json");if(o.setRemoteBackup=!1,o.write('{"version":"'+e.version+'"}'),Ti.API.info("Se actualizó la bd de Trucks. Se actualizaron las Imágenes! Bienvenido"),"iphone"===osname){var t=require("ui/common/IndexIOS");(new t).open()}if("ipad"===osname){var n=require("ui/common/IndexIpad");(new n).open()}},onerror:function(){if("iphone"===osname)var e=require("ui/common/IndexIOS");if("ipad"===osname)var e=require("ui/common/IndexIpad");(new e).open()},timeout:1e5});Ti.API.info("Se busca el zip con las imágenes:"),Ti.API.info("Buscando fecha de version de los trucks en general  a actualizar:");var c=Titanium.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),"version.json");c.setRemoteBackup=!1;var m="";c.exists()?(fileTmp=JSON.parse(c.read().text),m=fileTmp.version,Ti.API.info("Ultima fecha de actualización:"+m)):(Ti.API.info("Se busca por primera vez"),m="2014-10-01 13:00:0"),s.open("GET","http://s544443713.onlinehome.mx/AppTrucks/app/getZipTest.php?d="+m),s.send()}else{if("iphone"===osname)var u=require("ui/common/IndexIOS");if("ipad"===osname)var u=require("ui/common/IndexIpad");(new u).open()}});
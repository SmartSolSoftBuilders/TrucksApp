function retrieveData(e){versionJSONFiles=1;var i=Titanium.Network.createHTTPClient({onload:function(){var i=JSON.parse(this.responseText);e(i)},onerror:function(){var e=require("ui/common/Index");(new e).open()},timeout:1e3});Ti.API.info("Buscando fecha de version de los trucks en general  a actualizar:");var t=Titanium.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),"version.json"),n="";t.exists()?(fileTmp=JSON.parse(t.read().text),n=fileTmp.version,Ti.API.info("Ultima fecha de actualización:"+n)):(Ti.API.info("Se busca por primera vez"),n="2014-10-01 13:00:0"),Ti.API.info("Se envía http://s544443713.onlinehome.mx/AppTrucks/app/getUpdates.php?d="+n),i.open("GET","http://s544443713.onlinehome.mx/AppTrucks/app/getUpdates.php?d="+n),i.send()}var separadorImg="",osname=Ti.Platform.osname;separadorImg="iphone"===osname||"ipad"===osname?"":"mobileweb"===osname?"":"/";var win=Ti.UI.createWindow({backgroundImage:separadorImg+"ui/img/android/logo.png",fullscreen:!0});retrieveData(function(e){var i=e.version,t=e.numTrucks,n=e.trucks,o=Titanium.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),"version.json");if(o.exists()?(dataVersion=JSON.parse(o.read().text),Ti.API.info("Fecha de Versión Actual desde APD"+dataVersion.version)):(o=Titanium.Filesystem.getFile(Titanium.Filesystem.getResourcesDirectory(),"version.json"),dataVersion=JSON.parse(o.read().text),Ti.API.info("Fecha de Versión Actual desde RD"+dataVersion.version)),Ti.API.info(t+"?<"+i),t>0){Ti.API.info("!Hay nuevos datos disponibles!"),Ti.API.info("Trucks nuevos:"+n);var a=Titanium.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),"trucks.json");for(a.deleteFile(),a.write('{"trucks":'+JSON.stringify(n)+"}"),Ti.API.info("!Creando archivos individuales de los trucks!"+t),k=0;t>k;k++){var r=n[k],o=Titanium.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),n[k].idTruck+".json");o.exists()&&o.deleteFile(),o.write('{"datos":'+JSON.stringify(r)+"}"),Ti.API.info("Actualizo archivo:"+n[k].idTruck+".json")}var s=Titanium.Network.createHTTPClient({onload:function(){var i=Ti.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),"imagenesTrucks.zip");if(i.write(this.responseData),"iphone"===osname){var i=Ti.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),"imagenesTrucks.zip"),t=require("de.marcelpociot.zip");t.unzip({file:i,target:Ti.Filesystem.applicationDataDirectory,overwrite:!0,success:function(e){Ti.API.info("OK UNZIP"+e)},error:function(e){Ti.API.info("ERROR ZIP"+e)},progress:function(e){Ti.API.info("OK ZIP"+e)}})}else{var n=require("ti.compression"),o=n.unzip(Ti.Filesystem.getApplicationDataDirectory(),"imagenesTrucks.zip",!0);Ti.API.info("Unzip imgs:"+o)}var a=Titanium.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),"version.json");a.write('{"version":"'+e.version+'"}'),Ti.API.info("Se actualizó la bd de Trucks. Se actualizaron las Imágenes! Bienvenido");var r=require("ui/common/Welcome");(new r).open()},onerror:function(){},timeout:1e5});Ti.API.info("Se busca el zip con las imágenes:"),Ti.API.info("Buscando fecha de version de los trucks en general  a actualizar:");var c=Titanium.Filesystem.getFile(Titanium.Filesystem.getApplicationDataDirectory(),"version.json"),l="";c.exists()?(fileTmp=JSON.parse(c.read().text),l=fileTmp.version,Ti.API.info("Ultima fecha de actualización:"+l)):(Ti.API.info("Se busca por primera vez"),l="2014-10-01 13:00:0"),s.open("GET","http://s544443713.onlinehome.mx/AppTrucks/app/getZipTest.php?d="+l),s.send()}else{var u=require("ui/common/Welcome");(new u).open()}});var currentLat=.9,currentLon=0;if("iphone"===osname||"ipad"===osname){Ti.Geolocation.purpose="Recieve User Location",Titanium.Geolocation.getCurrentPosition(function(e){return e.success?(currentLon=e.coords.longitude,void(currentLat=e.coords.latitude)):void alert("Could not retrieve location")});var welcome=require("ui/common/IndexIOS");(new welcome).open()}